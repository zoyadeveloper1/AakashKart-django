{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Our Store</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="{% static 'css/style.css' %}">

<style>
.sidebar {
  background: #f8f9fa;
  padding: 15px;
  border-radius: 8px;
}

.product-card img {
  height: 200px;
  object-fit: cover;
}

.old-price {
  text-decoration: line-through;
  color: gray;
}

.price {
  color: #28a745;
  font-weight: bold;
}

.search-results {
  background: #fff3cd;
  padding: 10px;
  border-left: 5px solid #ffc107;
  border-radius: 5px;
}
</style>
</head>

<body>

<!-- ================= NAVBAR ================= -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark py-3">
<div class="container">

<a class="navbar-brand fw-bold" href="{% url 'home' %}">AakashKart</a>

<button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#nav">
<span class="navbar-toggler-icon"></span>
</button>

<div class="collapse navbar-collapse" id="nav">

<ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="{% url 'home' %}">Home</a></li>
<li class="nav-item"><a class="nav-link" href="{% url 'store:store' %}">Store</a></li>

<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle text-warning" data-bs-toggle="dropdown">Categories</a>
<ul class="dropdown-menu">
<li><a class="dropdown-item" href="{% url 'store:store' %}">All Products</a></li>
{% for category in categories %}
<li>
<a class="dropdown-item" href="{% url 'store:category' category.slug %}">
{{ category.category_name }}
</a>
</li>
{% endfor %}
</ul>
</li>
</ul>

<form class="d-flex" method="get" action="{% url 'store:store' %}">
<input class="form-control me-2" type="search" name="q" placeholder="Search..."
value="{{ query|default:'' }}">
<button class="btn btn-warning">üîç</button>
</form>

<ul class="navbar-nav ms-3">
<li class="nav-item"><a class="nav-link" href="/accounts/login/">Login</a></li>
<li class="nav-item"><a class="nav-link" href="/accounts/register/">Register</a></li>
<li class="nav-item"><a class="nav-link" href="#">Cart üõí</a></li>
</ul>

</div>
</div>
</nav>

<!-- ================= MAIN ================= -->
<div class="container-fluid my-4">
<div class="row">

<!-- ===== SIDEBAR ===== -->
<div class="col-md-3">
<div class="sidebar">
<h5 class="fw-bold">CATEGORIES</h5>
<a href="{% url 'store:store' %}" class="d-block mb-2">All Products</a>

{% for category in categories %}
<a class="d-block text-decoration-none"
   href="{% url 'store:category' category.slug %}">
{{ category.category_name }}
</a>
{% endfor %}
</div>
</div>

<!-- ===== PRODUCTS ===== -->
<div class="col-md-9">
<div class="row">

{% if query %}
<div class="col-12 search-results mb-3">
Search results for <b>"{{ query }}"</b>
</div>
{% endif %}

<div class="col-12 mb-3">
<h6>Total items: {{ product_count }}</h6>
</div>

{% for product in products %}
<div class="col-lg-4 col-md-6 mb-4">
<div class="card h-100 shadow-sm">

{% if product.image %}
<img src="{{ product.image.url }}" class="card-img-top">
{% else %}
<img src="{% static 'images/default.jpg' %}" class="card-img-top">
{% endif %}

<div class="card-body d-flex flex-column">
<h6>{{ product.product_name }}</h6>

<p>
{% if product.old_price %}
<span class="old-price">‚Çπ{{ product.old_price }}</span>
{% endif %}
<span class="price">‚Çπ{{ product.price }}</span>
</p>

<div class="mt-auto d-flex justify-content-between">
<a class="btn btn-sm btn-outline-primary"
   href="{% url 'store:product_detail' product.category.slug product.slug %}">
View
</a>

{% if product.stock > 0 %}
<!-- replace add_cart URL if namespace exists -->
<a class="btn btn-sm btn-success" href="#">
Add üõí
</a>
{% else %}
<span class="text-danger">Out of stock</span>
{% endif %}
</div>

</div>
</div>
</div>
{% empty %}
<p class="text-muted text-center">No products found</p>
{% endfor %}

</div>

<!-- ===== PAGINATION ===== -->
<div class="text-center mt-4">
{% if page_obj.has_previous %}
<a class="btn btn-outline-secondary"
   href="?page={{ page_obj.previous_page_number }}{% if query %}&q={{ query }}{% endif %}">
Previous
</a>
{% endif %}

<span class="mx-2">
Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
</span>

{% if page_obj.has_next %}
<a class="btn btn-outline-secondary"
   href="?page={{ page_obj.next_page_number }}{% if query %}&q={{ query }}{% endif %}">
Next
</a>
{% endif %}
</div>

</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
