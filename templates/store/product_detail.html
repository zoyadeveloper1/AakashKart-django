{% load static %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Our Store</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <style>
    .sidebar {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
    }
    .product-card img {
      width: 100%;
      height: 250px;   
      object-fit: cover;
      border-bottom: 1px solid #ddd;
    }
    .product-card .price {
      color: #28a745;
      font-weight: bold;
    }
    .product-card .old-price {
      text-decoration: line-through;
      color: gray;
      margin-right: 5px;
    }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark py-3">
  <div class="container">
    <a class="navbar-brand" href="{% url 'home' %}">AakashKart </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <!-- Left Links -->
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link" href="{% url 'home' %}">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'store' %}">Store</a></li>

       <!-- Categories Dropdown -->
<li class="nav-item dropdown">
  <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
     data-bs-toggle="dropdown" aria-expanded="false">
    All Categories
  </a>
  <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDropdown">
    <li><a class="dropdown-item" href="{% url 'store' %}">All Products</a></li>

    {% for category in categories %}
      <li><a class="dropdown-item" href="{{ category.get_url }}">{{ category.category_name }}</a></li>
    {% empty %}
      <li><a class="dropdown-item" href="#">No Categories Available</a></li>
    {% endfor %}
  </ul>
</li>


      <!-- Search bar -->
      <form class="d-flex mx-3" method="get" action="{% url 'store' %}">
        <input class="form-control me-2" type="search" name="q" placeholder="Search for products, brands and more">
        <button class="btn btn-warning" type="submit">Search</button>
      </form>

      <!-- Right Links -->
      <ul class="navbar-nav mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link" href="#">Login</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Register</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Cart üõí</a></li>
      </ul>
    </div>
  </div>
</nav>





<div class="container my-5">
    <div class="row g-4 align-items-center">
        <!-- Product Image -->
        <div class="col-12 col-md-6 text-center">
            <div class="product-image-box p-3 bg-light rounded shadow">
                {% if product.image %}
                    <img src="{{ product.image.url }}" alt="{{ product.product_name }}" class="img-fluid rounded">
                {% else %}
                    <img src="{% static 'images/default-product.jpg' %}" alt="{{ product.product_name }}" class="img-fluid rounded">
                {% endif %}
            </div>
        </div>

        <!-- Product Details -->
        <div class="col-12 col-md-6">
            <h2 class="fw-bold text-gradient">{{ single_product.product_name }}</h2>

            <!-- Ratings & Stock -->
            <p class="mb-2">
                {% for i in "12345" %}
                    {% if forloop.counter <= product.rating|default:0 %}
                        <span class="text-warning fs-5">&#9733;</span>
                    {% else %}
                        <span class="text-secondary fs-5">&#9733;</span>
                    {% endif %}
                {% endfor %}
                <small class="ms-2 text-muted">{{ product.rating|default:"0" }} / 5 ({{ product.order_count|default:"0" }} orders)</small>
            </p>
            <p>
                {% if product.is_available %}
                    <span class="badge bg-success px-3 py-2">‚úî In Stock</span>
                {% else %}
                    <span class="badge bg-danger px-3 py-2">‚ùå Out of Stock</span>
                {% endif %}
            </p>

            <!-- Price -->
            <h3 class="fw-bold text-primary">${{ product.price }}</h3>
            {% if product.old_price %}
                <p class="text-danger"><del>${{ product.old_price }}</del></p>
            {% endif %}

            <!-- Description -->
            <p class="mb-3 text-secondary">{{ product.description|default:"No description available." }}</p>

            <!-- Product Attributes -->
            <ul class="list-unstyled mb-3">
                <li><strong class="text-dark">Type:</strong> <span class="text-info">{{ product.type|default:"Regular" }}</span></li>
                <li><strong class="text-dark">Color:</strong> <span class="text-info">{{ product.color|default:"N/A" }}</span></li>
                <li><strong class="text-dark">Material:</strong> <span class="text-info">{{ product.material|default:"N/A" }}</span></li>
                <li><strong class="text-dark">Brand:</strong> <span class="text-info">{{ product.brand|default:"N/A" }}</span></li>
            </ul>

            <!-- Size & Quantity Form -->
            <form method="post" action="{% url 'add_cart' product.id %}">
                {% csrf_token %}
                <div class="row g-3 mb-3">
                    <div class="col-6 col-md-4">
                        <label for="size" class="form-label fw-bold">Size</label>
                        <select id="size" name="size" class="form-select border-primary">
                            {% for size in sizes %}
                                <option value="{{ size }}">{{ size }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="col-6 col-md-4">
                        <label for="quantity" class="form-label fw-bold">Quantity</label>
                        <div class="input-group">
                            <button type="button" class="btn btn-outline-danger" onclick="document.getElementById('quantity').stepDown()">-</button>
                            <input type="number" id="quantity" name="quantity" class="form-control text-center border-primary" value="1" min="1">
                            <button type="button" class="btn btn-outline-success" onclick="document.getElementById('quantity').stepUp()">+</button>
                        </div>
                    </div>
                </div>

                <!-- Add to Cart Button -->
{% if single_product.stock <= 0 %}
    <h5>OUT OF STOCK</h5>
{% else %}
    <button type="submit" class="btn btn-gradient btn-lg w-100 mt-2">Add to Cart üõí</button>
{% endif %}


<!-- üé® Custom Styles -->
<style>
    /* Gradient Text */
    .text-gradient {
        background: linear-gradient(45deg, #cf7d43, #ee0979);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    /* Gradient Button */
    .btn-gradient {
        background: linear-gradient(135deg, #667eea, #764ba2);
        border: none;
        color: #fff;
        transition: 0.3s ease;
        border-radius: 8px;
    }
    .btn-gradient:hover {
        background: linear-gradient(135deg, #764ba2, #667eea);
        transform: scale(1.05);
        box-shadow: 0px 4px 10px rgba(0,0,0,0.2);
    }

    /* Image Styling */
    .product-image-box {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        border-radius: 12px;
    }
    .img-fluid {
        max-height: 400px;
        object-fit: contain;
    }

    /* Responsive */
    @media (max-width: 767px) {
        h2 { font-size: 1.75rem; }
        h4 { font-size: 1.5rem; }
    }
</style>
{% endblock %}
<!-- ================= CUSTOMER REVIEWS ================= -->
<div class="container mt-5">
    <h3 class="fw-bold text-gradient mb-4">Customer Reviews üí¨</h3>

    <!-- Show Reviews -->
    <div class="reviews-list mb-4">
        {% if reviews %}
            {% for review in reviews %}
                <div class="review-card p-3 mb-3 shadow-sm rounded bg-light">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-1 fw-bold text-primary">{{ review.user.username }}</h6>
                        <small class="text-muted">{{ review.created_at|date:"M d, Y" }}</small>
                    </div>
                    <!-- Stars -->
                    <p class="mb-1">
                        {% for i in "12345" %}
                            {% if forloop.counter <= review.rating %}
                                <span class="text-warning fs-6">&#9733;</span>
                            {% else %}
                                <span class="text-secondary fs-6">&#9733;</span>
                            {% endif %}
                        {% endfor %}
                    </p>
                    <p class="mb-0 text-dark">{{ review.comment }}</p>
                </div>
            {% endfor %}
        {% else %}
            <p class="text-muted">No reviews yet. Be the first to review this product! üéâ</p>
        {% endif %}
    </div>

    <!-- Review Form -->
    {% if user.is_authenticated %}
    <div class="review-form bg-white p-4 rounded shadow-sm">
        <h5 class="fw-bold mb-3">Write a Review ‚úçÔ∏è</h5>
        <form method="post" action="{% url 'add_review' product.id %}">
            {% csrf_token %}
            <div class="mb-3">
                <label class="form-label">Rating</label>
                <select name="rating" class="form-select border-primary" required>
                    <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (Excellent)</option>
                    <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê (Good)</option>
                    <option value="3">‚≠ê‚≠ê‚≠ê (Average)</option>
                    <option value="2">‚≠ê‚≠ê (Poor)</option>
                    <option value="1">‚≠ê (Very Bad)</option>
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label">Your Review</label>
                <textarea name="comment" class="form-control border-primary" rows="3" required></textarea>
            </div>
            <button type="submit" class="btn btn-gradient">Submit Review üöÄ</button>
        </form>
    </div>
    {% else %}
        <p class="text-muted">üëâ <a href="{% url 'login' %}">Login</a> to write a review.</p>
    {% endif %}
</div>

